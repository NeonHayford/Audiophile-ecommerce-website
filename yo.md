```
[
    {
        "id": 1,
        "name": "ZX9 Speaker",
        "slug": "zx9-speaker",
        "price": "8999.99",
        "description": "Connect via Bluetooth or nearly any wired source. This speaker features optical, digital coaxial, USB Type-B, stereo RCA, and stereo XLR inputs, allowing you to have up to five wired source devices connected for easy switching. Improved bluetooth technology offers near lossless audio quality at up to 328ft (100m).\r\n\r\nDiscover clear, more natural sounding highs than the competition with ZX9’s signature planar diaphragm tweeter. Equally important is its powerful room-shaking bass courtesy of a 6.5” aluminum alloy bass unit. You’ll be able to enjoy equal sound quality whether in a large room or small den. Furthermore, you will experience new sensations from old songs since it can respond to even the subtle waveforms.",
        "Release_date": "2023-07-05",
        "Category": {
            "id": 1,
            "type": "Speakers",
            "slug": "speakers"
        },
        "image": {
            "id": 1,
            "main_image": "/product_images/main/image-product.jpg",
            "first_image": "/product_images/image-gallery-1.jpg",
            "second_image": "/product_images/image-gallery-2.jpg",
            "third_image": "/product_images/image-gallery-3.jpg"
        }
    },
    {
        "id": 2,
        "name": "XX59 Mark I Headphones",
        "slug": "xx59-mark-i-eadphones",
        "price": "799.99",
        "description": "These headphones have been created from durable, high-quality materials tough enough to take anywhere. Its compact folding design fuses comfort and minimalist style making it perfect for travel. Flawless transmission is assured by the latest wireless technology engineered for audio synchronization with videos.\r\n\r\nMore than a simple pair of headphones, this headset features a pair of built-in microphones for clear, hands-free calling when paired with a compatible smartphone. Controlling music and calls is also intuitive thanks to easy-access touch buttons on the earcups. Regardless of how you use the XX59 headphones, you can do so all day thanks to an impressive 30-hour battery life that can be rapidly recharged via USB-C.",
        "Release_date": "2023-07-05",
        "Category": {
            "id": 2,
            "type": "Headphones",
            "slug": "headphones"
        },
        "image": {
            "id": 2,
            "main_image": "/product_images/main/image-product_vMUKOI7.jpg",
            "first_image": "/product_images/image-gallery-1_2a6Izkj.jpg",
            "second_image": "/product_images/image-gallery-2_j5wHjt6.jpg",
            "third_image": "/product_images/image-gallery-3_1Yj3Qpq.jpg"
        }
    },
    {
        "id": 3,
        "name": "ZX7 Speaker",
        "slug": "zx7-speaker",
        "price": "1750.00",
        "description": "Reap the advantages of a flat diaphragm tweeter cone. This provides a fast response rate and excellent high frequencies that lower tiered bookshelf speakers cannot provide. The woofers are made from aluminum that produces a unique and clear sound. XLR inputs allow you to connect to a mixer for more advanced usage.\r\n\r\nThe ZX7 speaker is the perfect blend of stylish design and high performance. It houses an encased MDF wooden enclosure which minimises acoustic resonance. Dual connectivity allows pairing through bluetooth or traditional optical and RCA input. Switch input sources and control volume at your fingertips with the included wireless remote. This versatile speaker is equipped to deliver an authentic listening experience.",
        "Release_date": "2023-07-05",
        "Category": {
            "id": 1,
            "type": "Speakers",
            "slug": "speakers"
        },
        "image": {
            "id": 4,
            "main_image": "/product_images/main/image-product_9FcvsBl.jpg",
            "first_image": "/product_images/image-gallery-1_TmUpvLw.jpg",
            "second_image": "/product_images/image-gallery-2_spt43Dv.jpg",
            "third_image": "/product_images/image-gallery-3_dzbgWpj.jpg"
        }
    },
    {
        "id": 4,
        "name": "XX99 Mark II Headphones",
        "slug": "xx59-mark-ii-headphones",
        "price": "8759.99",
        "description": "Featuring a genuine leather head strap and premium earcups, these headphones deliver superior comfort for those who like to enjoy endless listening. It includes intuitive controls designed for any situation. Whether you’re taking a business call or just in your own personal space, the auto on/off and pause features ensure that you’ll never miss a beat.\r\n\r\nThe advanced Active Noise Cancellation with built-in equalizer allow you to experience your audio world on your terms. It lets you enjoy your audio in peace, but quickly interact with your surroundings when you need to. Combined with Bluetooth 5. 0 compliant connectivity and 17 hour battery life, the XX99 Mark II headphones gives you superior sound, cutting-edge technology, and a modern design aesthetic.",
        "Release_date": "2023-07-05",
        "Category": {
            "id": 2,
            "type": "Headphones",
            "slug": "headphones"
        },
        "image": {
            "id": 6,
            "main_image": "/product_images/main/image-product_LejxTCR.jpg",
            "first_image": "/product_images/image-gallery-1_13gHD2z.jpg",
            "second_image": "/product_images/image-gallery-2_aqG2OMn.jpg",
            "third_image": "/product_images/image-gallery-3_O6LbRlZ.jpg"
        }
    },
    {
        "id": 5,
        "name": "YX1 Wireless Earphones",
        "slug": "yx1-wireless-earphones",
        "price": "799.99",
        "description": "Experience unrivalled stereo sound thanks to innovative acoustic technology. With improved ergonomics designed for full day wearing, these revolutionary earphones have been finely crafted to provide you with the perfect fit, delivering complete comfort all day long while enjoying exceptional noise isolation and truly immersive sound.\r\n\r\nThe YX1 Wireless Earphones features customizable controls for volume, music, calls, and voice assistants built into both earbuds. The new 7-hour battery life can be extended up to 28 hours with the charging case, giving you uninterrupted play time. Exquisite craftsmanship with a splash resistant design now available in an all new white and grey color scheme as well as the popular classic black.",
        "Release_date": "2023-07-05",
        "Category": {
            "id": 3,
            "type": "Earphones",
            "slug": "earphones"
        },
        "image": {
            "id": 5,
            "main_image": "/product_images/main/image-product_6G2aqCo.jpg",
            "first_image": "/product_images/image-gallery-1_PRZKcgg.jpg",
            "second_image": "/product_images/image-gallery-2_6sgnkRm.jpg",
            "third_image": "/product_images/image-gallery-3_bT91omF.jpg"
        }
    },
    {
        "id": 6,
        "name": "XX59 Mark I Headphones",
        "slug": "xx59-mark-headphones",
        "price": "7999.99",
        "description": "These headphones have been created from durable, high-quality materials tough enough to take anywhere. Its compact folding design fuses comfort and minimalist style making it perfect for travel. Flawless transmission is assured by the latest wireless technology engineered for audio synchronization with videos.\r\n\r\nMore than a simple pair of headphones, this headset features a pair of built-in microphones for clear, hands-free calling when paired with a compatible smartphone. Controlling music and calls is also intuitive thanks to easy-access touch buttons on the earcups. Regardless of how you use the XX59 headphones, you can do so all day thanks to an impressive 30-hour battery life that can be rapidly recharged via USB-C.",
        "Release_date": "2023-07-05",
        "Category": {
            "id": 2,
            "type": "Headphones",
            "slug": "headphones"
        },
        "image": {
            "id": 3,
            "main_image": "/product_images/main/image-product_3WXR994.jpg",
            "first_image": "/product_images/image-gallery-1_iCLxcYq.jpg",
            "second_image": "/product_images/image-gallery-2_DcgOLh1.jpg",
            "third_image": "/product_images/image-gallery-3_wo3GEf2.jpg"
        }
    }
]

```



```
from django.conf import settings
from audiophile_store.models import Product
from decimal import Decimal


class Cart():
    
    def __init__(self, request):
        # Initialize the cart.
        self.session = request.session
        cart = self.session.get(settings.CART_SESSION_ID)
        if not cart:
            # save an empty cart in the session
            cart = self.session[settings.CART_SESSION_ID] = {}
        self.cart = cart
        # store current applied coupon
        self.coupon_id = self.session.get('coupon_id')

    def add(self, product, quantity = 1, total_quantity = False):
        product_id = str(product.id)
        if product_id is self.cart:
            self.cart['product_id']= {'quantity': 0, 'price': str(product.price)}
        if not total_quantity:
            self.cart['product_id']['quantity']  += quantity
        else:
            self.cart['product_id']['quantity']  = quantity
        self.save()

    def save(self):
        # mark the session as "modified" to make sure it gets saved
        self.session.modified = True

    def remove(self, product):
        # Remove a product from the cart.
        product_id = str(product.id)
        if product_id in self.cart:
            del self.cart[product_id]
            self.save()

    def __iter__(self):
        # Iterate over the items in the cart and get the products from the database.
        product_ids = self.cart.keys()
        # get the product objects and add them to the cart
        products = Product.objects.filter(id__in=product_ids)
        cart = self.cart.copy()
        for product in products:
            cart[str(product.id)]['product'] = product
        for item in cart.values():
            item['price'] = Decimal(item['price'])
            item['total_price'] = item['price'] * item['quantity']
            yield item

    def __len__(self):
        """Count all items in the cart."""
        return sum(item['quantity'] for item in self.cart.values())


    def get_total_price(self):
        # calculate the total cost of the items in the cart
        return sum(Decimal(item['price']) * item['quantity'] for item in self.cart.values())
    
    def get_vat_on_total_price(self):
        # calculate VAT on the total cost of the items in the cart 
        vat= self.get_total_price() * 0.2
        return vat
    

    def get_total_price_with_vat(self):
        # calculate VAT plus total cost of the items in the cart 
        return self.get_vat_on_total_price() + self.get_total_price()


    def clear(self):
        # remove cart from session
        del self.session[settings.CART_SESSION_ID]
        self.save()
```